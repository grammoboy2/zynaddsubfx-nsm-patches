From f71dc7659e373659d4e648cfd14d29661c8686db Mon Sep 17 00:00:00 2001
From: "Christopher A. Oliver" <caowasteland@gmail.com>
Date: Sat, 31 Oct 2015 00:28:10 -0400
Subject: [PATCH 0652/1936] Add fixed sync B.F.Mod operation, Chop.

p1 is coarse, p2 is fine, and p3 is phase.
---
 src/Synth/OscilGen.cpp | 5 ++++-
 src/UI/OscilGenUI.fl   | 4 ++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/Synth/OscilGen.cpp b/src/Synth/OscilGen.cpp
index c41d5059..d7c9cf69 100644
--- a/src/Synth/OscilGen.cpp
+++ b/src/Synth/OscilGen.cpp
@@ -71,7 +71,7 @@ const rtosc::Ports OscilGen::ports = {
             "Morph between possible base function shapes "
             "(e.g. rising sawtooth vs a falling sawtooth)"),
     rOption(Pbasefuncmodulation,
-            rOptions(None, Rev, Sine, Power),
+            rOptions(None, Rev, Sine, Power, Chop),
             "Modulation applied to Base function spectra"),
     rParamZyn(Pbasefuncmodulationpar1,
             "Base function modulation parameter"),
@@ -486,6 +486,9 @@ void OscilGen::getbasefunction(float *smps)
             case 3: //power
                 t += powf((1.0f - cosf((t + p2) * 2.0f * PI)) * 0.5f, p3) * p1;
                 break;
+            case 4: //chop
+                t = t * (powf(2.0, Pbasefuncmodulationpar1/32.0 +
+                              Pbasefuncmodulationpar2/2048.0)) + p3;
         }
 
         t = t - floor(t);
diff --git a/src/UI/OscilGenUI.fl b/src/UI/OscilGenUI.fl
index 51f40a41..5997991c 100644
--- a/src/UI/OscilGenUI.fl
+++ b/src/UI/OscilGenUI.fl
@@ -454,6 +454,10 @@ redrawoscil();}
                 label Pow
                 xywh {85 85 100 20} labelfont 1 labelsize 10
               }
+              MenuItem {} {
+                label Chop
+                xywh {95 95 100 20} labelfont 1 labelsize 10
+              }
             }
             Fl_Dial bfmodpar1 {
               callback {redrawoscil();}
-- 
2.47.0

