From 18a99cb0e9bf47f82d0caac716594e49067305bb Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Sat, 1 Dec 2012 14:45:51 -0500
Subject: [PATCH 0053/1936] DSSI: Fixes crash with small buffersizes

---
 src/Misc/Master.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/Misc/Master.cpp b/src/Misc/Master.cpp
index c3321b12..1f96672c 100644
--- a/src/Misc/Master.cpp
+++ b/src/Misc/Master.cpp
@@ -490,6 +490,7 @@ void Master::GetAudioOutSamples(size_t nsamples,
         if(nsamples >= smps) {
             memcpy(outl + out_off, bufl + off, sizeof(float) * smps);
             memcpy(outr + out_off, bufr + off, sizeof(float) * smps);
+            nsamples -= smps;
 
             //generate samples
             AudioOut(bufl, bufr);
@@ -497,7 +498,6 @@ void Master::GetAudioOutSamples(size_t nsamples,
             smps = synth->buffersize;
 
             out_off  += smps;
-            nsamples -= smps;
         }
         else {   //use some samples
             memcpy(outl + out_off, bufl + off, sizeof(float) * nsamples);
-- 
2.47.0

