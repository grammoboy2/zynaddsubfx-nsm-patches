From dce8241e738167fc99d2cb5f50dfd2431d9ea815 Mon Sep 17 00:00:00 2001
From: Hans Petter Selasky <hps@selasky.org>
Date: Sun, 5 Apr 2020 14:45:08 +0200
Subject: [PATCH 1522/1936] Keep PAmpVelocityScaleFunction::i alive for SUBnote
 parameters. The FLTK GUI uses it.

Signed-off-by: Hans Petter Selasky <hps@selasky.org>
---
 src/Params/SUBnoteParameters.cpp | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/src/Params/SUBnoteParameters.cpp b/src/Params/SUBnoteParameters.cpp
index 493b311f..3f71ce2f 100644
--- a/src/Params/SUBnoteParameters.cpp
+++ b/src/Params/SUBnoteParameters.cpp
@@ -42,6 +42,19 @@ static const rtosc::Ports SUBnotePorts = {
     rParamZyn(PPanning, rShort("panning"), rDefault(64), "Left Right Panning"),
     rParamF(AmpVelocityScaleFunction, rShort("sense"), rDefault(70.86),
         rLinear(0.0, 100.0), "Amplitude Velocity Sensing function"),
+    {"PAmpVelocityScaleFunction::i", rShort("sense") rProp(parameter) rLinear(0,127)
+        rDefault(90) rDoc("Amplitude Velocity Sensing function"), 0,
+        [](const char *m, rtosc::RtData &d) {
+            SUBnoteParameters *obj = (SUBnoteParameters*)d.obj;
+            if (rtosc_narguments(m)==0) {
+                d.reply(d.loc, "i", (int) roundf(obj->AmpVelocityScaleFunction * 127.0f / 100.0f));
+            } else if(rtosc_narguments(m)==1 && rtosc_type(m,0)=='i') {
+                const uint8_t value = limit<char>(rtosc_argument(m, 0).i, 0, 127);
+                obj->AmpVelocityScaleFunction = value * 100.0f / 127.0f;
+                d.broadcast(d.loc, "i", value);
+                rChangeCb
+            }
+    }},
     rParamI(PDetune,       rShort("detune"), rLinear(0, 16383), rDefault(8192),
         "Detune in detune type units"),
     rParamI(PCoarseDetune, rShort("cdetune"), rDefault(0), "Coarse Detune"),
-- 
2.47.0

