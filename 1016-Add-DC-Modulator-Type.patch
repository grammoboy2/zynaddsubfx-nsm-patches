From e5a26abc83e34306839997684397dad4ef0ea3cd Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Fri, 2 Sep 2016 19:01:14 -0400
Subject: [PATCH 1016/1936] Add DC Modulator Type

---
 src/Params/ADnoteParameters.cpp |  2 +-
 src/Synth/ADnote.cpp            | 14 +++++++++++++-
 src/Synth/ADnote.h              |  1 +
 3 files changed, 15 insertions(+), 2 deletions(-)

diff --git a/src/Params/ADnoteParameters.cpp b/src/Params/ADnoteParameters.cpp
index b67f5cde..35e515fc 100644
--- a/src/Params/ADnoteParameters.cpp
+++ b/src/Params/ADnoteParameters.cpp
@@ -78,7 +78,7 @@ static const Ports voicePorts = {
             "Subvoice vibratto speed"),
     rOption(Unison_invert_phase,       rShort("inv."),
             rOptions(none, random, 50%, 33%, 25%), "Subvoice Phases"),
-    rOption(Type,            rShort("type"), rOptions(Sound,White,Pink), "Type of Sound"),
+    rOption(Type,            rShort("type"), rOptions(Sound,White,Pink,DC), "Type of Sound"),
     rParamZyn(PDelay,        rShort("delay"), "Voice Startup Delay"),
     rToggle(Presonance,      rShort("enable"), "Resonance Enable"),
     rParamI(Pextoscil,       rShort("ext."),
diff --git a/src/Synth/ADnote.cpp b/src/Synth/ADnote.cpp
index aff2887f..9a9109ca 100644
--- a/src/Synth/ADnote.cpp
+++ b/src/Synth/ADnote.cpp
@@ -1523,6 +1523,15 @@ inline void ADnote::ComputeVoicePinkNoise(int nvoice)
     }
 }
 
+inline void ADnote::ComputeVoiceDC(int nvoice)
+{
+    for(int k = 0; k < unison_size[nvoice]; ++k) {
+        float *tw = tmpwave_unison[k];
+        for(int i = 0; i < synth.buffersize; ++i)
+            tw[i] = 1.0f;
+    }
+}
+
 
 
 /*
@@ -1568,9 +1577,12 @@ int ADnote::noteout(float *outl, float *outr)
             case 1:
                 ComputeVoiceWhiteNoise(nvoice);
                 break;
-            default:
+            case 2:
                 ComputeVoicePinkNoise(nvoice);
                 break;
+            default:
+                ComputeVoiceDC(nvoice);
+                break;
         }
         // Voice Processing
 
diff --git a/src/Synth/ADnote.h b/src/Synth/ADnote.h
index 71bb019f..0ed176c2 100644
--- a/src/Synth/ADnote.h
+++ b/src/Synth/ADnote.h
@@ -95,6 +95,7 @@ class ADnote:public SynthNote
         /**Generate Noise Samples for Voice*/
         inline void ComputeVoiceWhiteNoise(int nvoice);
         inline void ComputeVoicePinkNoise(int nvoice);
+        inline void ComputeVoiceDC(int nvoice);
 
         /**Fadein in a way that removes clicks but keep sound "punchy"*/
         inline void fadein(float *smps) const;
-- 
2.47.0

