From c46df0ff88997a61d45881d4f97320a1c97647dd Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Fri, 23 Oct 2015 11:03:41 -0400
Subject: [PATCH 0627/1936] JackEngine: Avoid Closing Invalid Jack Handles

Resolves sf bug #93
---
 src/Nio/JackEngine.cpp      | 1 +
 src/Nio/JackMultiEngine.cpp | 3 ++-
 src/Nio/Nio.cpp             | 3 ++-
 3 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/Nio/JackEngine.cpp b/src/Nio/JackEngine.cpp
index 5af59eec..a6e3c229 100644
--- a/src/Nio/JackEngine.cpp
+++ b/src/Nio/JackEngine.cpp
@@ -56,6 +56,7 @@ JackEngine::JackEngine(const SYNTH_T &synth)
     }
     midi.inport = NULL;
     midi.jack_sync = false;
+    osc.oscport = NULL;
 }
 
 bool JackEngine::connectServer(string server)
diff --git a/src/Nio/JackMultiEngine.cpp b/src/Nio/JackMultiEngine.cpp
index 6b4e8847..4c87f165 100644
--- a/src/Nio/JackMultiEngine.cpp
+++ b/src/Nio/JackMultiEngine.cpp
@@ -169,7 +169,8 @@ void JackMultiEngine::Stop()
             jack_port_unregister(impl->client, port);
     }
 
-    jack_client_close(impl->client);
+    if(impl->client)
+        jack_client_close(impl->client);
     impl->client = NULL;
 
     impl->running = false;
diff --git a/src/Nio/Nio.cpp b/src/Nio/Nio.cpp
index db77d45f..c1a7d48a 100644
--- a/src/Nio/Nio.cpp
+++ b/src/Nio/Nio.cpp
@@ -52,7 +52,8 @@ bool Nio::start()
 
 void Nio::stop()
 {
-    eng->stop();
+    if(eng)
+        eng->stop();
 }
 
 void Nio::setDefaultSource(string name)
-- 
2.47.0

