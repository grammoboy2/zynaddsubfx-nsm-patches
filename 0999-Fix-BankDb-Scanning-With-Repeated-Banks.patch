From dc34084583d9b775f28bcb2a6ed92970d41cf39b Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Sat, 6 Aug 2016 16:32:28 -0400
Subject: [PATCH 0999/1936] Fix BankDb Scanning With Repeated Banks

---
 src/Misc/Bank.cpp   | 4 +++-
 src/Misc/BankDb.cpp | 5 +++--
 2 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/src/Misc/Bank.cpp b/src/Misc/Bank.cpp
index 7e087fcf..1af8b900 100644
--- a/src/Misc/Bank.cpp
+++ b/src/Misc/Bank.cpp
@@ -364,9 +364,11 @@ void Bank::rescanforbanks()
     //sort the banks
     sort(banks.begin(), banks.end());
 
+    for(int i = 0; i < (int) banks.size(); ++i)
+        db->addBankDir(banks[i].dir);
+
     //remove duplicate bank names
     for(int j = 0; j < (int) banks.size() - 1; ++j) {
-        db->addBankDir(banks[j].dir);
         int dupl = 0;
         for(int i = j + 1; i < (int) banks.size(); ++i) {
             if(banks[i].name == banks[j].name) {
diff --git a/src/Misc/BankDb.cpp b/src/Misc/BankDb.cpp
index 83b27d01..9e3a9e3d 100644
--- a/src/Misc/BankDb.cpp
+++ b/src/Misc/BankDb.cpp
@@ -23,8 +23,8 @@ bool platform_strcasestr(const char *hay, const char *needle)
         for(int j=0; j<m; ++j) {
             if(toupper(hay[i+j]) != toupper(needle[j])) {
                 good = 0;
-break;
-}
+                break;
+            }
 
         }
         if(good)
@@ -235,6 +235,7 @@ BankEntry BankDb::processXiz(std::string filename, std::string bank) const
     //printf("Bank Entry:\n");
     //printf("\tname   - %s\n", entry.name.c_str());
     //printf("\tauthor - %s\n", line(entry.author).c_str());
+    //printf("\tbank   - %s\n", entry.bank.c_str());
     //printf("\tadd/pad/sub - %d/%d/%d\n", entry.add, entry.pad, entry.sub);
 
     return entry;
-- 
2.47.0

