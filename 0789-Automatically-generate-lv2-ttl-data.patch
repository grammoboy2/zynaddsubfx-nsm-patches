From 080bd3d3fed67f30df12a8ea164e12abeb9d2c40 Mon Sep 17 00:00:00 2001
From: falkTX <falktx@gmail.com>
Date: Sun, 13 Dec 2015 19:05:53 +0100
Subject: [PATCH 0789/1936] Automatically generate lv2 ttl data

---
 src/Plugin/AlienWah/CMakeLists.txt      | 4 ++++
 src/Plugin/CMakeLists.txt               | 5 +++++
 src/Plugin/Chorus/CMakeLists.txt        | 4 ++++
 src/Plugin/Distortion/CMakeLists.txt    | 4 ++++
 src/Plugin/DynamicFilter/CMakeLists.txt | 4 ++++
 src/Plugin/Echo/CMakeLists.txt          | 4 ++++
 src/Plugin/Phaser/CMakeLists.txt        | 4 ++++
 src/Plugin/Reverb/CMakeLists.txt        | 4 ++++
 8 files changed, 33 insertions(+)

diff --git a/src/Plugin/AlienWah/CMakeLists.txt b/src/Plugin/AlienWah/CMakeLists.txt
index 62b35a9a..b3df0cdb 100644
--- a/src/Plugin/AlienWah/CMakeLists.txt
+++ b/src/Plugin/AlienWah/CMakeLists.txt
@@ -19,3 +19,7 @@ target_link_libraries(ZynAlienWah_vst zynaddsubfx_core ${OS_LIBRARIES})
 
 install(TARGETS ZynAlienWah_lv2 LIBRARY DESTINATION lib/lv2/ZynAlienWah.lv2/)
 install(TARGETS ZynAlienWah_vst LIBRARY DESTINATION lib/vst/)
+
+add_custom_command(TARGET ZynAlienWah_lv2 POST_BUILD
+	COMMAND lv2-ttl-generator ./ZynAlienWah.so
+	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lv2)
diff --git a/src/Plugin/CMakeLists.txt b/src/Plugin/CMakeLists.txt
index 4da83fbf..9d0e81f6 100644
--- a/src/Plugin/CMakeLists.txt
+++ b/src/Plugin/CMakeLists.txt
@@ -1,4 +1,9 @@
 
+add_executable(lv2-ttl-generator ${CMAKE_SOURCE_DIR}/DPF/utils/lv2-ttl-generator/lv2_ttl_generator.c)
+
+# TODO: make this !win32 only
+target_link_libraries(lv2-ttl-generator "dl")
+
 add_subdirectory(AlienWah)
 add_subdirectory(Chorus)
 add_subdirectory(Distortion)
diff --git a/src/Plugin/Chorus/CMakeLists.txt b/src/Plugin/Chorus/CMakeLists.txt
index 0bbfb661..3a648360 100644
--- a/src/Plugin/Chorus/CMakeLists.txt
+++ b/src/Plugin/Chorus/CMakeLists.txt
@@ -19,3 +19,7 @@ target_link_libraries(ZynChorus_vst zynaddsubfx_core ${OS_LIBRARIES})
 
 install(TARGETS ZynChorus_lv2 LIBRARY DESTINATION lib/lv2/ZynChorus.lv2/)
 install(TARGETS ZynChorus_vst LIBRARY DESTINATION lib/vst/)
+
+add_custom_command(TARGET ZynChorus_lv2 POST_BUILD
+	COMMAND lv2-ttl-generator ./ZynChorus.so
+	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lv2)
diff --git a/src/Plugin/Distortion/CMakeLists.txt b/src/Plugin/Distortion/CMakeLists.txt
index 9b0e8056..7aacc8de 100644
--- a/src/Plugin/Distortion/CMakeLists.txt
+++ b/src/Plugin/Distortion/CMakeLists.txt
@@ -19,3 +19,7 @@ target_link_libraries(ZynDistortion_vst zynaddsubfx_core ${OS_LIBRARIES})
 
 install(TARGETS ZynDistortion_lv2 LIBRARY DESTINATION lib/lv2/ZynDistortion.lv2/)
 install(TARGETS ZynDistortion_vst LIBRARY DESTINATION lib/vst/)
+
+add_custom_command(TARGET ZynDistortion_lv2 POST_BUILD
+	COMMAND lv2-ttl-generator ./ZynDistortion.so
+	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lv2)
diff --git a/src/Plugin/DynamicFilter/CMakeLists.txt b/src/Plugin/DynamicFilter/CMakeLists.txt
index b33fe7db..c5e8b913 100644
--- a/src/Plugin/DynamicFilter/CMakeLists.txt
+++ b/src/Plugin/DynamicFilter/CMakeLists.txt
@@ -19,3 +19,7 @@ target_link_libraries(ZynDynamicFilter_vst zynaddsubfx_core ${OS_LIBRARIES})
 
 install(TARGETS ZynDynamicFilter_lv2 LIBRARY DESTINATION lib/lv2/ZynDynamicFilter.lv2/)
 install(TARGETS ZynDynamicFilter_vst LIBRARY DESTINATION lib/vst/)
+
+add_custom_command(TARGET ZynDynamicFilter_lv2 POST_BUILD
+	COMMAND lv2-ttl-generator ./ZynDynamicFilter.so
+	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lv2)
diff --git a/src/Plugin/Echo/CMakeLists.txt b/src/Plugin/Echo/CMakeLists.txt
index 10376b61..c7579c45 100644
--- a/src/Plugin/Echo/CMakeLists.txt
+++ b/src/Plugin/Echo/CMakeLists.txt
@@ -19,3 +19,7 @@ target_link_libraries(ZynEcho_vst zynaddsubfx_core ${OS_LIBRARIES})
 
 install(TARGETS ZynEcho_lv2 LIBRARY DESTINATION lib/lv2/ZynEcho.lv2/)
 install(TARGETS ZynEcho_vst LIBRARY DESTINATION lib/vst/)
+
+add_custom_command(TARGET ZynEcho_lv2 POST_BUILD
+	COMMAND lv2-ttl-generator ./ZynEcho.so
+	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lv2)
diff --git a/src/Plugin/Phaser/CMakeLists.txt b/src/Plugin/Phaser/CMakeLists.txt
index dc8911e5..1504c7c9 100644
--- a/src/Plugin/Phaser/CMakeLists.txt
+++ b/src/Plugin/Phaser/CMakeLists.txt
@@ -19,3 +19,7 @@ target_link_libraries(ZynPhaser_vst zynaddsubfx_core ${OS_LIBRARIES})
 
 install(TARGETS ZynPhaser_lv2 LIBRARY DESTINATION lib/lv2/ZynPhaser.lv2/)
 install(TARGETS ZynPhaser_vst LIBRARY DESTINATION lib/vst/)
+
+add_custom_command(TARGET ZynPhaser_lv2 POST_BUILD
+	COMMAND lv2-ttl-generator ./ZynPhaser.so
+	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lv2)
diff --git a/src/Plugin/Reverb/CMakeLists.txt b/src/Plugin/Reverb/CMakeLists.txt
index d5ec7471..66d494a1 100644
--- a/src/Plugin/Reverb/CMakeLists.txt
+++ b/src/Plugin/Reverb/CMakeLists.txt
@@ -19,3 +19,7 @@ target_link_libraries(ZynReverb_vst zynaddsubfx_core ${OS_LIBRARIES})
 
 install(TARGETS ZynReverb_lv2 LIBRARY DESTINATION lib/lv2/ZynReverb.lv2/)
 install(TARGETS ZynReverb_vst LIBRARY DESTINATION lib/vst/)
+
+add_custom_command(TARGET ZynReverb_lv2 POST_BUILD
+	COMMAND lv2-ttl-generator ./ZynReverb.so
+	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/lv2)
-- 
2.47.0

