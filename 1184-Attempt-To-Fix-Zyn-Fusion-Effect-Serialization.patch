From 9c824edaa1d6cacd5951740e4b6af2c793e71a68 Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Fri, 28 Jul 2017 11:09:30 -0400
Subject: [PATCH 1184/1936] Attempt To Fix Zyn-Fusion Effect Serialization

---
 src/Effects/EffectMgr.cpp | 7 ++++++-
 src/Tests/PluginTest.h    | 2 ++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/Effects/EffectMgr.cpp b/src/Effects/EffectMgr.cpp
index aeb1e0d2..35982248 100644
--- a/src/Effects/EffectMgr.cpp
+++ b/src/Effects/EffectMgr.cpp
@@ -466,7 +466,12 @@ void EffectMgr::add2XML(XMLwrapper& xml)
 
     xml.beginbranch("EFFECT_PARAMETERS");
     for(int n = 0; n < 128; ++n) {
-        int par = geteffectpar(n);
+        int par = 0;
+        if(efx)
+            par = efx->getpar(par);
+        else if(n<128)
+            par = settings[n];
+
         if(par == 0)
             continue;
         xml.beginbranch("par_no", n);
diff --git a/src/Tests/PluginTest.h b/src/Tests/PluginTest.h
index 49d045fb..dc6c8731 100644
--- a/src/Tests/PluginTest.h
+++ b/src/Tests/PluginTest.h
@@ -157,6 +157,8 @@ void print_string_differences(string orig, string next)
 
         }
         //printf("%d vs %d\n", N, M);
+    } else {
+        printf("[WARNING] XML File appears to be radically different\n");
     }
 }
 
-- 
2.47.0

