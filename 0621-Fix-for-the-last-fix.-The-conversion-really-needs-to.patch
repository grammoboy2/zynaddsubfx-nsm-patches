From 9346984eaf978b94c2d6fcb00d078378c7e718bc Mon Sep 17 00:00:00 2001
From: "Christopher A. Oliver" <caowasteland@gmail.com>
Date: Tue, 20 Oct 2015 17:10:16 -0400
Subject: [PATCH 0621/1936] Fix for the last fix.  The conversion really needs
 to move to setpos()

---
 src/DSP/FormantFilter.cpp | 20 ++++++++++----------
 1 file changed, 10 insertions(+), 10 deletions(-)

diff --git a/src/DSP/FormantFilter.cpp b/src/DSP/FormantFilter.cpp
index a771d0de..6e1dd504 100644
--- a/src/DSP/FormantFilter.cpp
+++ b/src/DSP/FormantFilter.cpp
@@ -88,10 +88,18 @@ void FormantFilter::cleanup()
         formant[i]->cleanup();
 }
 
-void FormantFilter::setpos(float input)
+inline float log_2(float x)
+{
+    return logf(x) / logf(2.0f);
+}
+
+void FormantFilter::setpos(float frequency)
 {
     int p1, p2;
 
+    //Convert form real freq[Hz]
+    const float input = log_2(frequency) - 9.96578428f; //log2(1000)=9.95748f.
+
     if(firsttime != 0)
         slowinput = input;
     else
@@ -173,17 +181,9 @@ void FormantFilter::setpos(float input)
     oldQfactor = Qfactor;
 }
 
-inline float log_2(float x)
-{
-    return logf(x) / logf(2.0f);
-}
-
 void FormantFilter::setfreq(float frequency)
 {
-    //Convert form real freq[Hz]
-    const float freq = log_2(frequency) - 9.96578428f; //log2(1000)=9.95748f.
-
-    setpos(freq);
+    setpos(frequency);
 }
 
 void FormantFilter::setq(float q_)
-- 
2.47.0

