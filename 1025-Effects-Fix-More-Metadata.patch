From 1c47ef1c9cd76d350e108a10ff1d2445f1cbd72f Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Mon, 19 Sep 2016 16:57:09 -0400
Subject: [PATCH 1025/1936] Effects: Fix More Metadata

---
 src/Effects/Alienwah.cpp      | 6 +++---
 src/Effects/Chorus.cpp        | 2 +-
 src/Effects/DynamicFilter.cpp | 2 +-
 src/Effects/EffectMgr.cpp     | 2 ++
 src/Effects/Phaser.cpp        | 8 ++++----
 5 files changed, 11 insertions(+), 9 deletions(-)

diff --git a/src/Effects/Alienwah.cpp b/src/Effects/Alienwah.cpp
index 0eb54a9b..ae4e1c85 100644
--- a/src/Effects/Alienwah.cpp
+++ b/src/Effects/Alienwah.cpp
@@ -39,10 +39,10 @@ rtosc::Ports Alienwah::ports = {
     rEffPar(Pfreqrnd,  3, rShort("rand"), "Frequency Randomness"),
     rEffPar(PLFOtype,  4, rShort("shape"),
             rOptions(sine, triangle), "LFO Shape"),
-    rEffParTF(PStereo, 5, rShort("stereo"), "Stereo/Mono Mode"),
+    rEffPar(PStereo,   5, rShort("stereo"), "Stereo Mode"),
     rEffPar(Pdepth,    6, rShort("depth"), "LFO Depth"),
     rEffPar(Pfeedback, 7, rShort("fb"), "Feedback"),
-    rEffPar(Pdelay,    8, rShort("delay"), "Delay"),
+    rEffPar(Pdelay,    8, rLinear(1,100), rShort("delay"), "Delay"),
     rEffPar(Plrcross,  9, rShort("l/r"), "Left/Right Crossover"),
     rEffPar(Pphase,   10, rShort("phase"), "Phase"),
 };
@@ -166,7 +166,7 @@ void Alienwah::setdelay(unsigned char _Pdelay)
 {
     memory.devalloc(oldl);
     memory.devalloc(oldr);
-    Pdelay = (_Pdelay >= MAX_ALIENWAH_DELAY) ? MAX_ALIENWAH_DELAY : _Pdelay;
+    Pdelay = limit<int>(_Pdelay, 1, MAX_ALIENWAH_DELAY);
     oldl   = memory.valloc<complex<float>>(Pdelay);
     oldr   = memory.valloc<complex<float>>(Pdelay);
     cleanup();
diff --git a/src/Effects/Chorus.cpp b/src/Effects/Chorus.cpp
index b568d7eb..87d2cc76 100644
--- a/src/Effects/Chorus.cpp
+++ b/src/Effects/Chorus.cpp
@@ -42,7 +42,7 @@ rtosc::Ports Chorus::ports = {
     rEffPar(Pfreqrnd, 3, rShort("rand"), "Frequency Randomness"),
     rEffPar(PLFOtype, 4, rShort("shape"),
             rOptions(sine, tri), "LFO Shape"),
-    rEffParTF(PStereo,5, rShort("stereo"), "Stereo/Mono Mode"),
+    rEffPar(PStereo,  5, rShort("stereo"), "Stereo Mode"),
     rEffPar(Pdepth,   6, rShort("depth"), "LFO Depth"),
     rEffPar(Pdelay,   7, rShort("delay"), "Delay"),
     rEffPar(Pfeedback,8, rShort("fb"), "Feedback"),
diff --git a/src/Effects/DynamicFilter.cpp b/src/Effects/DynamicFilter.cpp
index 78165add..42e1dccb 100644
--- a/src/Effects/DynamicFilter.cpp
+++ b/src/Effects/DynamicFilter.cpp
@@ -38,7 +38,7 @@ rtosc::Ports DynamicFilter::ports = {
     rEffPar(Pfreqrnd,   3, rShort("rand"),      "Frequency Randomness"),
     rEffPar(PLFOtype,   4, rShort("shape"),
           rOptions(sin, tri), "LFO Shape"),
-    rEffPar(PStereo,    5, rShort("stereo"),    "Stereo/Mono Mode"),
+    rEffPar(PStereo,    5, rShort("stereo"),    "Stereo Mode"),
     rEffPar(Pdepth,     6, rShort("depth"),     "LFO Depth"),
     rEffPar(Pampsns,    7, rShort("sense"),     "how the filter varies according to the input amplitude"),
     rEffPar(Pampsnsinv, 8, rShort("sns.inv"),   "Sense Inversion"),
diff --git a/src/Effects/EffectMgr.cpp b/src/Effects/EffectMgr.cpp
index 36b422b5..a34d3832 100644
--- a/src/Effects/EffectMgr.cpp
+++ b/src/Effects/EffectMgr.cpp
@@ -38,6 +38,8 @@
         [](const char *msg, rtosc::RtData &data){\
             rObject &o = *(rObject*)data.obj; \
             data.obj = o.efx; \
+            if(!dynamic_cast<name*>(o.efx)) \
+                return; \
             SNIP \
             name::ports.dispatch(msg, data); \
         }}
diff --git a/src/Effects/Phaser.cpp b/src/Effects/Phaser.cpp
index 697fa5ad..db9059e1 100644
--- a/src/Effects/Phaser.cpp
+++ b/src/Effects/Phaser.cpp
@@ -47,10 +47,10 @@ rtosc::Ports Phaser::ports = {
     rEffPar(lfo.Prandomness, 3, rShort("rnd."),     ""),
     rEffPar(lfo.PLFOtype,    4, rShort("type"),
           rOptions(sine, tri), "lfo shape"),
-    rEffParTF(lfo.Pstereo,   5, rShort("stereo"),   ""),
+    rEffPar(lfo.Pstereo,     5, rShort("stereo"),   ""),
     rEffPar(Pdepth,          6, rShort("depth"),    ""),
     rEffPar(Pfb,             7, rShort("fb"),       ""),
-    rEffPar(Pstages,         8, rShort("stages"),   ""),
+    rEffPar(Pstages,         8, rLinear(1,12), rShort("stages"),   ""),
     rEffPar(Plrcross,        9, rShort("cross"),    ""),
     rEffPar(Poffset,         9, rShort("off"),      "Offset"),
     rEffParTF(Poutsub,      10, rShort("sub"),      ""),
@@ -326,7 +326,7 @@ void Phaser::setoffset(unsigned char Poffset)
     offsetpct     = (float)Poffset / 127.0f;
 }
 
-void Phaser::setstages(unsigned char Pstages)
+void Phaser::setstages(unsigned char Pstages_)
 {
     memory.devalloc(old.l);
     memory.devalloc(old.r);
@@ -335,7 +335,7 @@ void Phaser::setstages(unsigned char Pstages)
     memory.devalloc(yn1.l);
     memory.devalloc(yn1.r);
 
-    this->Pstages = min(MAX_PHASER_STAGES, (int)Pstages);
+    Pstages = limit<int>(Pstages_, 1, MAX_PHASER_STAGES);
 
     old = Stereo<float *>(memory.valloc<float>(Pstages * 2),
                           memory.valloc<float>(Pstages * 2));
-- 
2.47.0

