From e1ef1a7d25db6a1ad152d8bd960ce1bba342e611 Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Sat, 9 Dec 2017 09:26:12 -0500
Subject: [PATCH 1230/1936] Force '..' in directory listing

In theory this fixes missing '..' directories on windows.
---
 src/Misc/MiddleWare.cpp | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/Misc/MiddleWare.cpp b/src/Misc/MiddleWare.cpp
index ca3d194f..f78420f2 100644
--- a/src/Misc/MiddleWare.cpp
+++ b/src/Misc/MiddleWare.cpp
@@ -904,6 +904,7 @@ static std::vector<std::string> getFiles(const char *folder, bool finddir)
 
     struct dirent *fn;
     std::vector<string> files;
+    bool has_updir = false;
 
     while((fn = readdir(dir))) {
 #ifndef WIN32
@@ -929,8 +930,14 @@ static std::vector<std::string> getFiles(const char *folder, bool finddir)
 #endif
         if(finddir == is_dir && strcmp(".", fn->d_name))
             files.push_back(fn->d_name);
+
+        if(!strcmp("..", fn->d_name))
+            has_updir = true;
     }
 
+    if(finddir == true && has_updir == false)
+        files.push_back("..");
+
     closedir(dir);
     std::sort(begin(files), end(files));
     return files;
-- 
2.47.0

