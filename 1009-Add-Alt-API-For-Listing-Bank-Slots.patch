From 7581a9d40f1243d6b5fa7528bf3413933ce333a6 Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Thu, 18 Aug 2016 16:06:42 -0400
Subject: [PATCH 1009/1936] Add Alt API For Listing Bank Slots

---
 src/Misc/Bank.cpp       | 14 ++++++++++++++
 src/Misc/Bank.h         |  1 +
 src/Misc/MiddleWare.cpp | 13 +++++++++++++
 3 files changed, 28 insertions(+)

diff --git a/src/Misc/Bank.cpp b/src/Misc/Bank.cpp
index 1af8b900..76697421 100644
--- a/src/Misc/Bank.cpp
+++ b/src/Misc/Bank.cpp
@@ -471,6 +471,20 @@ std::vector<std::string> Bank::search(std::string s) const
     }
     return out;
 }
+        
+std::vector<std::string> Bank::blist(std::string s)
+{
+    std::vector<std::string> out;
+    int result = loadbank(s);
+    for(int i=0; i<128; ++i) {
+        if(ins[i].filename.empty())
+            out.push_back("Empty Preset");
+        else
+            out.push_back(ins[i].name);
+        out.push_back(to_s(i));
+    }
+    return out;
+}
 
 int Bank::addtobank(int pos, string filename, string name)
 {
diff --git a/src/Misc/Bank.h b/src/Misc/Bank.h
index aa7684da..3f99daf4 100644
--- a/src/Misc/Bank.h
+++ b/src/Misc/Bank.h
@@ -77,6 +77,7 @@ class Bank
         } ins[BANK_SIZE];
 
         std::vector<std::string> search(std::string) const;
+        std::vector<std::string> blist(std::string);
 
     private:
 
diff --git a/src/Misc/MiddleWare.cpp b/src/Misc/MiddleWare.cpp
index 28a25ae1..cd434817 100644
--- a/src/Misc/MiddleWare.cpp
+++ b/src/Misc/MiddleWare.cpp
@@ -1073,6 +1073,19 @@ const rtosc::Ports bankPorts = {
             res_dat[i].s = res[i].c_str();
         }
         d.replyArray("/bank/search_results", res_type, res_dat);
+#undef MAX_SEARCH
+        rEnd},
+    {"blist:s", 0, 0,
+        rBegin;
+        auto res = impl.blist(rtosc_argument(msg, 0).s);
+#define MAX_SEARCH 300
+        char res_type[MAX_SEARCH+1] = {0};
+        rtosc_arg_t res_dat[MAX_SEARCH] = {0};
+        for(unsigned i=0; i<res.size() && i<MAX_SEARCH; ++i) {
+            res_type[i]  = 's';
+            res_dat[i].s = res[i].c_str();
+        }
+        d.replyArray("/bank/search_results", res_type, res_dat);
 #undef MAX_SEARCH
         rEnd},
     {"search_results:", 0, 0,
-- 
2.47.0

