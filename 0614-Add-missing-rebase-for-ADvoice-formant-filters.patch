From e398eb6a0b5667f2791f9c6d57928f7a042f76d3 Mon Sep 17 00:00:00 2001
From: "Christopher A. Oliver" <caowasteland@gmail.com>
Date: Sun, 18 Oct 2015 19:28:34 -0400
Subject: [PATCH 0614/1936] Add missing rebase for ADvoice formant filters

---
 src/UI/FilterUI.fl            |  1 +
 src/UI/FormantFilterGraph.H   |  2 ++
 src/UI/FormantFilterGraph.cpp | 13 +++++++++++++
 3 files changed, 16 insertions(+)

diff --git a/src/UI/FilterUI.fl b/src/UI/FilterUI.fl
index ca6a1b2b..db5b3912 100644
--- a/src/UI/FilterUI.fl
+++ b/src/UI/FilterUI.fl
@@ -473,6 +473,7 @@ filterparamswindow->redraw();} {}
   Function {rebase(std::string new_base)} {open
   } {
     code {
+    formantparswindow->rebase(new_base+"VoiceFilter/");
     Fl_Osc_Group::rebase(new_base);
   } {}
   }
diff --git a/src/UI/FormantFilterGraph.H b/src/UI/FormantFilterGraph.H
index 1480d93d..e4acaf8a 100644
--- a/src/UI/FormantFilterGraph.H
+++ b/src/UI/FormantFilterGraph.H
@@ -24,6 +24,8 @@ class FormantFilterGraph : public Fl_Box, public Fl_Osc_Widget {
         void OSC_value(int x, const char *) override;
         void OSC_value(unsigned x, void *v) override;
 
+        void rebase(std::string new_base) override;
+
         void updateVowel(int);
         void updateFormant(int);
 
diff --git a/src/UI/FormantFilterGraph.cpp b/src/UI/FormantFilterGraph.cpp
index 0717c26c..ac60d38c 100644
--- a/src/UI/FormantFilterGraph.cpp
+++ b/src/UI/FormantFilterGraph.cpp
@@ -83,6 +83,19 @@ void FormantFilterGraph::update(void)
     oscWrite("Pq");
 }
 
+void FormantFilterGraph::rebase(std::string new_base)
+{
+    osc->renameLink(loc+"Pvowels", new_base+"Pvowels", this);
+    osc->renameLink(loc+"Pnumformants", new_base+"Pnumformants", this);
+    osc->renameLink(loc+"Pstages", new_base+"Pstages", this);
+    osc->renameLink(loc+"Pcenterfreq", new_base+"Pcenterfreq", this);
+    osc->renameLink(loc+"Poctavesfreq", new_base+"Poctavesfreq", this);
+    osc->renameLink(loc+"Pgain", new_base+"Pgain", this);
+    osc->renameLink(loc+"Pq", new_base+"Pq", this);
+    loc = new_base;
+    update();
+}
+
 //TODO A good portion of this is copy/pasta from EnvelopUI's widget
 //     REFACTOR!
 void FormantFilterGraph::draw()
-- 
2.47.0

