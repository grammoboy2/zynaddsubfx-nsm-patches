From 0c143cd3c267f4d74a40be91c180a3471b345887 Mon Sep 17 00:00:00 2001
From: michiboo <chanmickyyun@gmail.com>
Date: Wed, 26 Jun 2019 20:22:43 +0300
Subject: [PATCH 1382/1936] add trigger to wp

---
 src/Synth/WatchPoint.cpp | 4 +++-
 src/Synth/WatchPoint.h   | 1 +
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/Synth/WatchPoint.cpp b/src/Synth/WatchPoint.cpp
index 73279c18..f023e46c 100644
--- a/src/Synth/WatchPoint.cpp
+++ b/src/Synth/WatchPoint.cpp
@@ -125,6 +125,7 @@ void WatchManager::tick(void)
             memset(data_list[i], 0, sizeof(float)*128);
             sample_list[i] = 0;
             deactivate[i]  = false;
+            trigger[i] = false;
         }
     }
 
@@ -183,9 +184,10 @@ void WatchManager::satisfy(const char *id, float *f, int n)
                     sample_list[selected]++;
                 }
             else{
-                 if(f[i] > -4){
+                 if(trigger[selected] || f[i] > 0){
                     data_list[selected][sample_list[selected]] = f[i];
                     sample_list[selected]++;
+                    trigger[selected] = true;
                 }
             }
         }
diff --git a/src/Synth/WatchPoint.h b/src/Synth/WatchPoint.h
index d4d4e92f..f492f91d 100644
--- a/src/Synth/WatchPoint.h
+++ b/src/Synth/WatchPoint.h
@@ -42,6 +42,7 @@ struct WatchManager
     float   data_list[MAX_WATCH][MAX_SAMPLE];
     int     sample_list[MAX_WATCH];
     bool    deactivate[MAX_WATCH];
+    bool trigger[MAX_WATCH];
 
     //External API
     WatchManager(thrlnk *link=0);
-- 
2.47.0

