From 89cb6e1488243dfb75b93c5636a3adefc377220b Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Wed, 18 Jun 2014 12:09:04 -0400
Subject: [PATCH 0188/1936] Fix EnvelopeUI Behavior on Paste

Part of the Christopher Oliver patch set
---
 src/UI/EnvelopeUI.fl | 18 +++++++++++++++---
 1 file changed, 15 insertions(+), 3 deletions(-)

diff --git a/src/UI/EnvelopeUI.fl b/src/UI/EnvelopeUI.fl
index e1602d84..4f518096 100644
--- a/src/UI/EnvelopeUI.fl
+++ b/src/UI/EnvelopeUI.fl
@@ -162,9 +162,13 @@ if (lastpoint>=0){
     code {int x_=Fl::event_x()-x();
 int y_=Fl::event_y()-y();
 
+// Some window magic makes us lose focus, so reassert it.
+if (event==FL_ENTER)
+    Fl::focus(this);
+
 if ((event==FL_KEYDOWN || event==FL_KEYUP)){
-    int key = Fl::event_key();
-    if (key==FL_Control_L || key==FL_Control_R){
+   int key = Fl::event_key();
+   if (key==FL_Control_L || key==FL_Control_R){
         ctrldown = (event==FL_KEYDOWN);
         redraw();
         if (pair!=NULL) pair->redraw();
@@ -808,9 +812,17 @@ if ((env->Pfreemode==0)||(env->Envmode>2)) linearenvelopecheck->hide();
 
 forcedreleasecheck->value(env->Pforcedrelease);
 if (env->Pfreemode==0) forcedreleasecheck->hide();
+	else forcedreleasecheck->show();
 
-freeedit->redraw();
+if (env->Pfreemode==0){
+	addpoint->hide();
+	deletepoint->hide();
+} else {
+	addpoint->show();
+	deletepoint->show();
+}
 
+freeedit->redraw();
 
 if (env->Pfreemode==0){
    switch(env->Envmode){
-- 
2.47.0

