From 4fb09e32a753d5eb961f1174ddb7b6d0b91802da Mon Sep 17 00:00:00 2001
From: Daniel Sheeler <dsheeler@pobox.com>
Date: Sun, 30 Sep 2018 02:03:00 -0500
Subject: [PATCH 1290/1936] FMVolume -> PFMVolume

---
 src/Params/ADnoteParameters.cpp | 16 ++++++++--------
 src/Params/ADnoteParameters.h   |  2 +-
 src/Synth/ADnote.cpp            |  8 ++++----
 3 files changed, 13 insertions(+), 13 deletions(-)

diff --git a/src/Params/ADnoteParameters.cpp b/src/Params/ADnoteParameters.cpp
index 51f3b282..2b7580cc 100644
--- a/src/Params/ADnoteParameters.cpp
+++ b/src/Params/ADnoteParameters.cpp
@@ -157,7 +157,7 @@ static const Ports voicePorts = {
                 frequency, pulse), rDefault(none), "Modulator mode"),
     rParamI(PFMVoice,                   rShort("voice"), rDefault(-1),
         "Modulator Oscillator Selection"),
-    rParamF(FMvolume,                   rShort("vol."),  rLinear(0.0, 100.0),
+    rParamF(PFMvolume,                   rShort("vol."),  rLinear(0.0, 100.0),
         rDefault(70.0),                 "Modulator Magnitude"),
     rParamZyn(PFMVolumeDamp,            rShort("damp."), rDefault(64),
         "Modulator HF dampening"),
@@ -228,10 +228,10 @@ static const Ports voicePorts = {
         {
             rObject *obj = (rObject *)d.obj;
             if (!rtosc_narguments(msg))
-                d.reply(d.loc, "i", (int)roundf(127.0f * obj->FMvolume
+                d.reply(d.loc, "i", (int)roundf(127.0f * obj->PFMvolume
                     / 100.0f));
             else
-                obj->FMvolume = 100.0f * rtosc_argument(msg, 0).i / 127.0f;
+                obj->PFMvolume = 100.0f * rtosc_argument(msg, 0).i / 127.0f;
         }},
     //weird stuff for PCoarseDetune
     {"FMdetunevalue:", rMap(unit,cents) rDoc("Get modulator detune"), NULL, [](const char *, RtData &d)
@@ -535,7 +535,7 @@ void ADnoteVoiceParam::defaults()
     //I use the internal oscillator (-1)
     PFMVoice = -1;
 
-    FMvolume       = 70.0;
+    PFMvolume       = 70.0;
     PFMVolumeDamp   = 64;
     PFMDetune       = 8192;
     PFMCoarseDetune = 0;
@@ -799,7 +799,7 @@ void ADnoteVoiceParam::add2XML(XMLwrapper& xml, bool fmoscilused)
         xml.beginbranch("FM_PARAMETERS");
         xml.addpar("input_voice", PFMVoice);
 
-        xml.addparreal("volume", FMvolume);
+        xml.addparreal("volume", PFMvolume);
         xml.addpar("volume_damp", PFMVolumeDamp);
         xml.addpar("velocity_sensing",
                     PFMVelocityScaleFunction);
@@ -1100,7 +1100,7 @@ void ADnoteVoiceParam::paste(ADnoteVoiceParam &a)
     RCopy(FilterLfo);
 
     copy(PFMVoice);
-    copy(FMvolume);
+    copy(PFMvolume);
     copy(PFMVolumeDamp);
     copy(PFMVelocityScaleFunction);
 
@@ -1280,9 +1280,9 @@ void ADnoteVoiceParam::getfromXML(XMLwrapper& xml, unsigned nvoice)
         PFMVoice      = xml.getpar("input_voice", PFMVoice, -1, nvoice - 1);
         if (upgrade_3_0_3) {
             int Pvolume = xml.getpar127("volume", 0);
-            FMvolume    = 100.0f * Pvolume / 127.0f;
+            PFMvolume    = 100.0f * Pvolume / 127.0f;
         } else {
-            FMvolume    = xml.getparreal("volume", FMvolume);
+            PFMvolume    = xml.getparreal("volume", PFMvolume);
         }
         PFMVolumeDamp = xml.getpar127("volume_damp", PFMVolumeDamp);
         PFMVelocityScaleFunction = xml.getpar127("velocity_sensing",
diff --git a/src/Params/ADnoteParameters.h b/src/Params/ADnoteParameters.h
index d884e23c..23082643 100644
--- a/src/Params/ADnoteParameters.h
+++ b/src/Params/ADnoteParameters.h
@@ -270,7 +270,7 @@ struct ADnoteVoiceParam {
     OscilGen *FMSmp;
 
     /* Modullator Volume */
-    float FMvolume;
+    float PFMvolume;
 
     /* Modullator damping at higher frequencies */
     unsigned char PFMVolumeDamp;
diff --git a/src/Synth/ADnote.cpp b/src/Synth/ADnote.cpp
index cdc6b209..6d5dccae 100644
--- a/src/Synth/ADnote.cpp
+++ b/src/Synth/ADnote.cpp
@@ -484,7 +484,7 @@ void ADnote::setupVoiceMod(int nvoice, bool first_run)
     //Compute the Voice's modulator volume (incl. damping)
     float fmvoldamp = powf(440.0f / getvoicebasefreq(nvoice),
             param.PFMVolumeDamp / 64.0f - 1.0f);
-    const float fmvolume_ = param.FMvolume / 100.0f;
+    const float fmvolume_ = param.PFMvolume / 100.0f;
     switch(voice.FMEnabled) {
         case PHASE_MOD:
         case PW_MOD:
@@ -634,19 +634,19 @@ void ADnote::legatonote(LegatoParams lpars)
                              nvoice), pars.VoicePar[nvoice].PFMVolumeDamp
                          / 64.0f);
                 NoteVoicePar[nvoice].FMVolume =
-                    (expf(pars.VoicePar[nvoice].FMvolume / 100.0f
+                    (expf(pars.VoicePar[nvoice].PFMvolume / 100.0f
                           * FM_AMP_MULTIPLIER) - 1.0f) * fmvoldamp * 4.0f;
                 break;
             case FREQ_MOD:
                 NoteVoicePar[nvoice].FMVolume =
-                    (expf(pars.VoicePar[nvoice].FMvolume / 100.0f
+                    (expf(pars.VoicePar[nvoice].PFMvolume / 100.0f
                           * FM_AMP_MULTIPLIER) - 1.0f) * fmvoldamp * 4.0f;
                 break;
             default:
                 if(fmvoldamp > 1.0f)
                     fmvoldamp = 1.0f;
                 NoteVoicePar[nvoice].FMVolume =
-                    pars.VoicePar[nvoice].FMvolume
+                    pars.VoicePar[nvoice].PFMvolume
                     / 100.0f * fmvoldamp;
         }
 
-- 
2.47.0

