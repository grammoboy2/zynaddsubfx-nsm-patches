From 5a384f7a70f4a023e68e095357c6b5bbce1d4301 Mon Sep 17 00:00:00 2001
From: Ihor Khomyn <hoorkeet@gmail.com>
Date: Wed, 1 Mar 2017 20:13:53 +0200
Subject: [PATCH 1118/1936] Fixed FXs to force zero-output when they are muted

---
 src/Effects/Echo.cpp   | 6 +++++-
 src/Effects/Reverb.cpp | 6 +++++-
 2 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/Effects/Echo.cpp b/src/Effects/Echo.cpp
index ba7171be..0e98d9bb 100644
--- a/src/Effects/Echo.cpp
+++ b/src/Effects/Echo.cpp
@@ -145,7 +145,11 @@ void Echo::setvolume(unsigned char _Pvolume)
     Pvolume = _Pvolume;
 
     if(insertion == 0) {
-        outvolume = powf(0.01f, (1.0f - Pvolume / 127.0f)) * 4.0f;
+        if (Pvolume == 0) {
+            outvolume = 0.0f;
+        } else {
+            outvolume = powf(0.01f, (1.0f - Pvolume / 127.0f)) * 4.0f;
+        }
         volume    = 1.0f;
     }
     else
diff --git a/src/Effects/Reverb.cpp b/src/Effects/Reverb.cpp
index f1c5b841..e3f78527 100644
--- a/src/Effects/Reverb.cpp
+++ b/src/Effects/Reverb.cpp
@@ -215,7 +215,11 @@ void Reverb::setvolume(unsigned char _Pvolume)
 {
     Pvolume = _Pvolume;
     if(!insertion) {
-        outvolume = powf(0.01f, (1.0f - Pvolume / 127.0f)) * 4.0f;
+        if (Pvolume == 0) {
+            outvolume = 0.0f;
+        } else {
+            outvolume = powf(0.01f, (1.0f - Pvolume / 127.0f)) * 4.0f;
+        }
         volume    = 1.0f;
     }
     else {
-- 
2.47.0

