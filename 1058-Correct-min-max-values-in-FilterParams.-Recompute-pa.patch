From a0dedf1fc5510aef2660e8e40b0cb96878a9dd5b Mon Sep 17 00:00:00 2001
From: Johannes Lorenz <johannes89@ist-einmalig.de>
Date: Tue, 11 Oct 2016 21:41:43 +0200
Subject: [PATCH 1058/1936] Correct min-/max-values in FilterParams. Recompute
 parameters after DynFilter paste.

---
 src/Effects/EffectMgr.cpp   | 1 +
 src/Misc/Util.h             | 3 +++
 src/Params/FilterParams.cpp | 9 ++++-----
 3 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/src/Effects/EffectMgr.cpp b/src/Effects/EffectMgr.cpp
index 65dc7ba8..1e2148b2 100644
--- a/src/Effects/EffectMgr.cpp
+++ b/src/Effects/EffectMgr.cpp
@@ -459,6 +459,7 @@ void EffectMgr::paste(EffectMgr &e)
         std::swap(filterpars, e.filterpars);
         efx->filterpars = filterpars;
     }
+    cleanup(); // cleanup the effect and recompute its parameters
 }
 
 void EffectMgr::add2XML(XMLwrapper& xml)
diff --git a/src/Misc/Util.h b/src/Misc/Util.h
index 9bd424af..2a27d9e1 100644
--- a/src/Misc/Util.h
+++ b/src/Misc/Util.h
@@ -20,6 +20,9 @@
 #include <algorithm>
 #include <set>
 
+#include <rtosc/ports.h>
+#include <rtosc/port-sugar.h>
+
 using std::min;
 using std::max;
 
diff --git a/src/Params/FilterParams.cpp b/src/Params/FilterParams.cpp
index 33a93129..d4ea76b4 100644
--- a/src/Params/FilterParams.cpp
+++ b/src/Params/FilterParams.cpp
@@ -73,8 +73,8 @@ const rtosc::Ports FilterParams::ports = {
     rParamZyn(Pfreqtrack,       rShort("f.track"),
             "Frequency Tracking amount"),
     rParamZyn(Pgain,            rShort("gain"),     "Output Gain"),
-    rParamZyn(Pnumformants,     rShort("formants"),
-            "Number of formants to be used"),
+    rParamI(Pnumformants,       rShort("formants"),
+            rLinear(1,12),  "Number of formants to be used"),
     rParamZyn(Pformantslowness, rShort("slew"),
             "Rate that formants change"),
     rParamZyn(Pvowelclearness,  rShort("clarity"),
@@ -84,12 +84,11 @@ const rtosc::Ports FilterParams::ports = {
     rParamZyn(Poctavesfreq,     rShort("octaves"),
             "Number of octaves for formant"),
 
-    //TODO check if FF_MAX_SEQUENCE is acutally expanded or not
-    rParamZyn(Psequencesize,    rShort("seq.size"), rMap(max, FF_MAX_SEQUENCE), "Length of vowel sequence"),
+    rParamI(Psequencesize,    rShort("seq.size"), rLinear(0, FF_MAX_SEQUENCE), "Length of vowel sequence"),
     rParamZyn(Psequencestretch, rShort("seq.str"), "How modulators stretch the sequence"),
     rToggle(Psequencereversed,  rShort("reverse"), "If the modulator input is inverted"),
 
-    {"vowel_seq#" STRINGIFY(FF_MAX_SEQUENCE) "::i", "", NULL,
+    {"vowel_seq#" STRINGIFY(FF_MAX_SEQUENCE) "::i", rShort("vowel") rDoc("Vowel number of this sequence position"), NULL,
         [](const char *msg, RtData &d){
             FilterParams *obj = (FilterParams *) d.obj;
             const char *mm = msg;
-- 
2.47.0

