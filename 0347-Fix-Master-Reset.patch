From dedd40a47a20e1caed3d5cee86a3eb2c79e953ff Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Sat, 21 Feb 2015 17:33:27 -0500
Subject: [PATCH 0347/1936] Fix Master Reset

---
 src/Misc/MiddleWare.cpp | 8 ++++++--
 src/UI/MasterUI.fl      | 1 +
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/Misc/MiddleWare.cpp b/src/Misc/MiddleWare.cpp
index 684e118f..e986aff4 100644
--- a/src/Misc/MiddleWare.cpp
+++ b/src/Misc/MiddleWare.cpp
@@ -661,8 +661,10 @@ public:
     void loadMaster(const char *filename)
     {
         Master *m = new Master();
-        m->loadXML(filename);
-        m->applyparameters();
+        if(filename) {
+            m->loadXML(filename);
+            m->applyparameters();
+        }
 
         //Update resource locator table
         obj_store.clear();
@@ -1049,6 +1051,8 @@ void MiddleWareImpl::handleMsg(const char *msg)
         savePart(rtosc_argument(msg,0).i,rtosc_argument(msg,1).s);
     } else if(strstr(msg, "/load_xmz") && !strcmp(rtosc_argument_string(msg), "s")) {
         loadMaster(rtosc_argument(msg,0).s);
+    } else if(strstr(msg, "/reset_master") && !strcmp(rtosc_argument_string(msg), "")) {
+        loadMaster(NULL);
     } else if(!strcmp(msg, "/load_xiz") && !strcmp(rtosc_argument_string(msg), "is")) {
         pending_load[rtosc_argument(msg,0).i]++;
         loadPart(rtosc_argument(msg,0).i, rtosc_argument(msg,1).s, master, osc);
diff --git a/src/UI/MasterUI.fl b/src/UI/MasterUI.fl
index e0a1d03a..df2a98b5 100644
--- a/src/UI/MasterUI.fl
+++ b/src/UI/MasterUI.fl
@@ -1532,6 +1532,7 @@ simplelistitemgroup->redraw();} {}
   }
   Function {do_new_master_unconditional()} {} {
     code {delete microtonalui;
+microtonalui=new MicrotonalUI(osc, "/microtonal/");
 
     osc->write("/reset_master");
        npartcounter->value(1);
-- 
2.47.0

