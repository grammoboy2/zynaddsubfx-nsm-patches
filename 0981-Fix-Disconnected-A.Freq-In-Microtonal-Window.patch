From c161555449dd6d87b2d70fd54d0d75b88f6c89f8 Mon Sep 17 00:00:00 2001
From: fundamental <mark.d.mccurry@gmail.com>
Date: Wed, 27 Jul 2016 18:23:04 -0400
Subject: [PATCH 0981/1936] Fix Disconnected A.Freq In Microtonal Window

---
 src/UI/Fl_Osc_Value.H   |  3 +++
 src/UI/Fl_Osc_Value.cpp | 23 +++++++++++++++++++++--
 2 files changed, 24 insertions(+), 2 deletions(-)

diff --git a/src/UI/Fl_Osc_Value.H b/src/UI/Fl_Osc_Value.H
index 3a0a4aa1..9fc722e0 100644
--- a/src/UI/Fl_Osc_Value.H
+++ b/src/UI/Fl_Osc_Value.H
@@ -21,4 +21,7 @@ class Fl_Osc_Value: public Fl_Value_Input, public Fl_Osc_Widget
         
         //Normal Initialization
         void init(const char *path);
+        void OSC_value(float v);
+
+        void cb();
 };
diff --git a/src/UI/Fl_Osc_Value.cpp b/src/UI/Fl_Osc_Value.cpp
index c7e2c82f..426b3611 100644
--- a/src/UI/Fl_Osc_Value.cpp
+++ b/src/UI/Fl_Osc_Value.cpp
@@ -11,16 +11,35 @@
 */
 #include "Fl_Osc_Value.H"
 
+static void callback_fn_value(Fl_Widget *w, void *)
+{
+    ((Fl_Osc_Value*)w)->cb();
+}
+
 Fl_Osc_Value::Fl_Osc_Value(int X, int Y, int W, int H, const char *label)
     :Fl_Value_Input(X,Y,W,H, label), Fl_Osc_Widget(this)
 {
+    Fl_Value_Input::callback(callback_fn_value);
 }
 
 Fl_Osc_Value::~Fl_Osc_Value(void)
 {}
 
-void Fl_Osc_Value::init(const char *path)
+void Fl_Osc_Value::init(const char *path_)
+{
+    ext = path_;
+    oscRegister(path_);
+}
+
+void Fl_Osc_Value::OSC_value(float v)
 {
-    (void)path;
+    //static char value[1024];
+    //snprintf(value, sizeof(value), "%f", v);
+    this->value(v);
 }
 
+void Fl_Osc_Value::cb(void)
+{
+    assert(osc);
+    oscWrite(ext, "f", (float)(value()));
+}
-- 
2.47.0

