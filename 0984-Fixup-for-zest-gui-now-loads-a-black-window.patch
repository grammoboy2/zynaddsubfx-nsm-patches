From 882ee94ac67ad601afe50311418f6d377f72ec7f Mon Sep 17 00:00:00 2001
From: falkTX <falktx@gmail.com>
Date: Thu, 28 Jul 2016 16:42:51 +0200
Subject: [PATCH 0984/1936] Fixup for zest gui, now loads a black window :)

---
 src/CMakeLists.txt                            |  1 +
 src/Plugin/ZynAddSubFX/CMakeLists.txt         |  2 ++
 .../ZynAddSubFX/ZynAddSubFX-UI-Zest.cpp       | 31 ++++++++-----------
 3 files changed, 16 insertions(+), 18 deletions(-)

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 4edb5d3f..99ae653a 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -376,6 +376,7 @@ if(NtkGui)
 endif()
 
 if(ZestGui)
+    add_definitions(-DHAVE_DGL)
     add_definitions(-DZEST_GUI)
 endif()
 
diff --git a/src/Plugin/ZynAddSubFX/CMakeLists.txt b/src/Plugin/ZynAddSubFX/CMakeLists.txt
index 64d4d6b0..3ec7fa5f 100644
--- a/src/Plugin/ZynAddSubFX/CMakeLists.txt
+++ b/src/Plugin/ZynAddSubFX/CMakeLists.txt
@@ -1,6 +1,7 @@
 
 include_directories(${CMAKE_CURRENT_BINARY_DIR}
     ${CMAKE_SOURCE_DIR}/DPF/distrho .
+    ${CMAKE_SOURCE_DIR}/DPF/dgl
     ${CMAKE_SOURCE_DIR}/DPF/dgl/src)
 
 if(NtkGui)
@@ -45,6 +46,7 @@ add_library(ZynAddSubFX_vst SHARED
     ZynAddSubFX.cpp)
 
 elseif(ZestGui)
+
 # UI Enabled using Zest: internal only
 add_library(ZynAddSubFX_lv2 SHARED
     ${CMAKE_SOURCE_DIR}/src/globals.cpp
diff --git a/src/Plugin/ZynAddSubFX/ZynAddSubFX-UI-Zest.cpp b/src/Plugin/ZynAddSubFX/ZynAddSubFX-UI-Zest.cpp
index 2205e208..06141471 100644
--- a/src/Plugin/ZynAddSubFX/ZynAddSubFX-UI-Zest.cpp
+++ b/src/Plugin/ZynAddSubFX/ZynAddSubFX-UI-Zest.cpp
@@ -13,8 +13,6 @@
 
 // DPF includes
 #include "DistrhoUI.hpp"
-#include "../../../DPF/dgl/Window.hpp"
-#include "../../../DPF/dgl/Application.hpp"
 
 /* ------------------------------------------------------------------------------------------------------------
  * ZynAddSubFX UI class */
@@ -22,27 +20,16 @@
 class ZynAddSubFXUI : public UI
 {
 public:
-    ZynAddSubFXUI(const intptr_t wid, const char* const bpath)
-        : UI(390, 525),
-          win(app),
-          oscPort(0)
+    ZynAddSubFXUI()
+        : UI(390, 525)
     {
-        setTitle("ZynAddSubFX");
         printf("[INFO] Opened the zynaddsubfx UI...\n");
-
-        win.setSize(100,200);
-        win.show();
-
-        (void) wid;
-        (void) bpath;
     }
 
     ~ZynAddSubFXUI() override
     {
     }
 
-    Window win;
-    Application app;
 protected:
    /* --------------------------------------------------------------------------------------------------------
     * DSP/Plugin Callbacks */
@@ -82,6 +69,16 @@ protected:
     {
     }
 
+   /* --------------------------------------------------------------------------------------------------------
+    * UI Callbacks */
+
+   /**
+      A function called to draw the view contents with OpenGL.
+    */
+    void onDisplay() override
+    {
+    }
+
 private:
     int oscPort;
 
@@ -96,9 +93,7 @@ START_NAMESPACE_DISTRHO
 
 UI* createUI()
 {
-    const char* const bundlePath = 0;
-
-    return new ZynAddSubFXUI(0, bundlePath);
+    return new ZynAddSubFXUI();
 }
 
 END_NAMESPACE_DISTRHO
-- 
2.47.0

