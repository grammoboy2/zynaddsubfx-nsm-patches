From 41881a95ddbb9dfcdd9f01bb11196da8b3a8d883 Mon Sep 17 00:00:00 2001
From: Hans Petter Selasky <hps@selasky.org>
Date: Sat, 19 Nov 2022 14:59:06 +0100
Subject: [PATCH 1868/1936] Let InMgr::flush() return a boolean indicating if
 all MIDI events have been processed or not.

Signed-off-by: Hans Petter Selasky <hps@selasky.org>
---
 src/Nio/InMgr.cpp | 7 ++++++-
 src/Nio/InMgr.h   | 2 +-
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/Nio/InMgr.cpp b/src/Nio/InMgr.cpp
index e714f9ba..abb0545c 100644
--- a/src/Nio/InMgr.cpp
+++ b/src/Nio/InMgr.cpp
@@ -91,12 +91,16 @@ void InMgr::putEvent(MidiEvent ev)
         work.post();
 }
 
-void InMgr::flush(unsigned frameStart, unsigned frameStop)
+bool InMgr::flush(unsigned frameStart, unsigned frameStop)
 {
     MidiEvent ev;
+    bool endReached = true;
+
     while(!work.trywait()) {
         queue.peak(ev);
         if(ev.time < (int)frameStart || ev.time > (int)frameStop) {
+            //Check if end was reached
+            endReached = ev.time < (int)frameStart;
             //Back out of transaction
             work.post();
             //printf("%d vs [%d..%d]\n",ev.time, frameStart, frameStop);
@@ -145,6 +149,7 @@ void InMgr::flush(unsigned frameStart, unsigned frameStop)
                 break;
         }
     }
+    return endReached;
 }
 
 bool InMgr::empty(void) const
diff --git a/src/Nio/InMgr.h b/src/Nio/InMgr.h
index 0bb4c345..ff691c8c 100644
--- a/src/Nio/InMgr.h
+++ b/src/Nio/InMgr.h
@@ -47,7 +47,7 @@ class InMgr
         void putEvent(MidiEvent ev);
 
         /**Flush the Midi Queue*/
-        void flush(unsigned frameStart, unsigned frameStop);
+        bool flush(unsigned frameStart, unsigned frameStop);
 
         bool empty() const;
 
-- 
2.47.0

